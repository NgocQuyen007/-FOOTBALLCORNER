sportApp.controller("TeamSettingCtrl",["$scope","TeamService","$routeParams","CommonService","ImageUpload","$rootScope",function(n,t,i,r,u){function f(){setTimeout(function(){if($("#sltLevel").val(n.team.levelId).trigger("change"),$("#sltProvince").val(n.teamProvinceId).trigger("change"),$("#teamHomeDayOfWeek").val(n.team.homeDayOfWeek).trigger("change"),n.team.homeStadiumName!=null&&n.team.homeStadiumName!=""){$('[idd="sltStadium"]').append('<option value="'+n.team.homeStadiumId+'" selected="selected">'+n.team.homeStadiumName+"<\/option>");TeamSettingsHelper.onSearchStadiumSelectedChange({id:n.team.homeStadiumId,selectedId:n.team.homeStadiumNumberId})}},1e3)}n.teamId=teamData.activeTeamGuid;n.team={levelId:1,provinceId:3,countryId:1,typeId:1,id:0,homeDayOfWeek:0};n.teamProvinceId=3;n.listTypes=[];n.listAgeGroups=[];n.listLevels=[];n.listProvinces=[];n.listCounties=[];n.currentProvince={};n.activePage="";n.loadTeam=function(){common.ui.showLoading();commonData.allType!=null&&commonData.allType.length>0?n.listTypes=commonData.allType:r.getAllCommonItems("type").then(function(t){n.listTypes=t.records;commonData.allType=t.records});commonData.allAgeGroup!=null&&commonData.allAgeGroup.length>0?n.listAgeGroups=commonData.allAgeGroup:r.getAllCommonItems("agegroup").then(function(t){n.listAgeGroups=t.records;commonData.allAgeGroup=t.records});commonData.allLevel!=null&&commonData.allLevel.length>0?n.listLevels=commonData.allLevel:r.getAllCommonItems("level").then(function(t){n.listLevels=t.records;commonData.allLevel=t.records});n.teamId!=undefined&&n.teamId>0?t.retrieveTeam(n.teamId).then(function(t){t.isSuccessful?(n.team=t.record,n.teamProvinceId=n.team.provinceId,n.team.logicalName=n.getTeamNaviUrl(t.record),commonData.allProvinces!=null&&commonData.allProvinces.length>0?n.listProvinces=commonData.allProvinces:r.getAllProvinces(n.team.countryId).then(function(t){n.listProvinces=t.records;commonData.allProvinces=t.records}),f(n.team),common.ui.hideLoading()):setTimeout(function(){common.ui.hideLoading()},500)}):(commonData.allProvinces!=null&&commonData.allProvinces.length>0?(n.listProvinces=commonData.allProvinces,f(n.team)):r.getAllProvinces(n.team.countryId).then(function(t){n.listProvinces=t.records;commonData.allProvinces=t.records;f(n.team);common.ui.hideLoading()}),common.ui.hideLoading())};n.onChangeProvince=function(){e(n.teamProvinceId)};n.onSave=function(i){common.ui.showLoading();n.team.provinceId=$("#sltProvince").val();n.team.countyId=$("#sltCounty").val();var r=$('[idd="sltStadium"]').val();isNaN(r)?(n.team.homeStadiumId=null,n.team.homeStadiumName=r):(n.team.homeStadiumId=parseInt(r),n.team.homeStadiumName=null);n.team.homeStadiumNumberId=$("#stadiumNumberContainer").is(":visible")?parseInt($("#sltStadiumNumber").val()):null;n.team.logoFilePath!=""&&$(".tabs-chi-tiet-doi .img-doio .img-responsive").attr("src",n.team.logoFilePath);n.team.typeId=1;$(i.toElement).button("loading");n.team.id==0?t.insertTeam(n.team).then(function(t){common.ui.hideLoading();common.ui.notification.success("Thêm mới thành công.");var i=n.getTeamUrl(n.team.name,t.teamId);window.location.href=i}):t.updateTeam(n.team).then(function(){common.ui.hideLoading();common.ui.notification.success("Cập nhật thành công.");$(i.toElement).button("reset")})};$("#fileLogoFilePath").change(function(){setTimeout(function(){n.uploadLogo()},100)});n.uploadLogo=function(){common.ui.showLoading();u.uploadToUrl(n.imageLogo).then(function(t){n.team.logoFilePath=t.link;common.ui.hideLoading()})};$("#fileBannerFilePath").change(function(){setTimeout(function(){n.uploadBanner()},100)});n.uploadBanner=function(){common.ui.showLoading();u.uploadToUrl(n.imageBanner).then(function(t){n.team.bannerFilePath=t.link;common.ui.hideLoading()})};n.getTeamNaviUrl=function(n){return n.logicalName&&n.logicalName!=""?n.logicalName.substr(1):"team/view/"+n.id};n.checkTeamLogicalName=function(t){$(t.toElement).button("loading");r.checkLogicalName(262,n.team.id,n.team.logicalName).then(function(i){n.checkLogicalName=i.isSuccessful?1:2;$(t.toElement).button("reset")})};var e=function(t){r.getAllCounties(t).then(function(t){n.listCounties=t.records})};n.loadTeam()}]);var TeamSettingsHelper={onSearchStadiumSelectedChange:function(n){if(isNaN(n.id)){$("#stadiumNumberContainer").hide();return}var t={stadiumName:n.text,stadiumId:parseInt(n.id)};common.ui.showLoading();$.ajax({type:"POST",url:common.config.serviceDomain+"api/stadiums/searchStadiumNumbers",contentType:"application/json",data:JSON.stringify(t),headers:{"X-Auth-Token":common.config.xAuthToken},success:function(t){$("#sltStadiumNumber").html("");t.isSuccessful&&t.records.length>0?($("#stadiumNumberContainer").show(),$.each(t.records,function(t,i){var r=i.id==n.selectedId?"selected":"";$("#sltStadiumNumber").append('<option value="'+i.id+'" '+r+">"+i.name+"<\/option>")})):$("#stadiumNumberContainer").hide();common.ui.hideLoading()},error:function(){console.log("An error occurred while get showtimes!");common.ui.hideLoading()}})}};sportApp.controller("TeamUserCtrl",["$scope","TeamService","$routeParams","CommonService","ImageUpload",function(n,t){n.teamGuid=teamData.activeTeamGuid;n.userList=[];n.totalUser=0;n.key="";n.activePage="users";n.activeTeamUserRoleId=teamData.activeTeamUserRoleId;$(".list-link-doi > li").removeClass("active");$(".list-link-doi > li#team-users").addClass("active");n.showRemoveUserTeam=function(t){return n.activeTeamUserRoleId==common.config.role.Leader&&t!=common.config.role.Leader};n.showContactLeader=function(t){return n.activeTeamUserRoleId==0&&t!=common.config.role.Leader};n.onLoadUsers=function(){common.ui.showLoading();t.loadUsers(n.teamGuid).then(function(t){common.ui.hideLoading();n.userList=t.records;n.totalUser=t.totalRecords})};n.showAddUser=function(){common.ui.modal.show("modalTeamAddUser")};n.onAddUser=function(i){var r=$('[idd="sltUserNamePhoneMail"]').val(),u;n.key!=""&&r!=""&&(u=$("#invite-username-extra").val(),$(i.toElement).button("loading"),common.ui.showLoading(),t.addUsers(n.teamGuid,r,u).then(function(t){t.isSuccessful?common.ui.notification.success("Thêm mới thành viên thành công.!"):common.ui.notification.error("Có lỗi xảy ra trong quá trình thêm mới thành viên.!");n.userList=t.records;n.totalUser=t.totalRecords;common.ui.hideLoading();common.ui.modal.hide("modalTeamAddUser");$('[idd="sltUserNamePhoneMail"]').val("").trigger("change");$(i.toElement).button("reset")}))};n.onConfirmRemoveUser=function(t){n.activeTeamUser=t;common.ui.modal.show("modalTeamRemoveUser")};n.onshowRemoveUser=function(n){return n.roleId!=common.config.role.Leader};n.onRemoveUser=function(){common.ui.showLoading();t.deleteUser(n.teamGuid,n.activeTeamUser.userId).then(function(t){n.userList=n.userList.filter(function(t){return t.userId!=n.activeTeamUser.userId?t:null});common.ui.hideLoading();t.isSuccessful?common.ui.notification.success("Xóa thành công.!"):common.ui.notification.error("Có lỗi xảy ra trong quá trình xóa.!")})};n.onLoadUsers();$(document).ready(function(){$("#btnAddUsers").mousemove(function(){var t=$("#sltUserNamePhoneMail .select2-search__field").val();t!=""&&(n.key=t)})})}]);sportApp.controller("TeamFundManagementCtrl",["$scope","TeamService","$routeParams","CommonService",function(n,t,i,r){function u(t){n.headline=t.headline;n.formattedDepositAmount=t.formattedDepositAmount;n.formattedExpenseAmount=t.formattedExpenseAmount;n.formattedRemainAmount=t.formattedRemainAmount;n.fomarttedTotalFinalRemainAmount=t.fomarttedTotalFinalRemainAmount;n.formattedTotalPrevRemainAmount=t.formattedTotalPrevRemainAmount;n.totalFinalRemainAmount=t.totalFinalRemainAmount}function e(){$("#newFundExpenseDateTime").datetimepicker2({timepicker:!1,format:"d/m/Y",defaultDate:new Date})}n.teamGuid=teamData.activeTeamGuid?teamData.activeTeamGuid:$("#TeamId").val();n.headline="Cập nhật quỹ";n.activeTab="tfm-deposits";n.allMonths=r.getAllMonths();n.isLoading=!0;$(".list-link-doi > li").removeClass("active");$(".list-link-doi > li#team-fundmanagement").addClass("active");n.newExpense={expenseId:0};n.selectedMonth=n.allMonths[(new Date).getMonth()];n.year=(new Date).getFullYear();n.yearList=[];for(var f=n.year-10;f<=n.year+1;f++)n.yearList.push(f);n.onYearOrMonthChange=function(){n.activeTab=="tfm-deposits"?n.loadMemberDeposits():n.loadExpenses()};n.loadMemberDeposits=function(){n.activeTab="tfm-deposits";common.ui.showLoading();n.loadingOverlay=!0;t.loadMemberDeposits(n.teamGuid,n.selectedMonth.value,n.year).then(function(t){n.memberDeposits=t.records;u(t);common.ui.hideLoading();n.isLoading=!1;n.loadingOverlay=!1})};n.addOrUpdateDeposit=function(i){common.ui.showLoading();i.isLoading=!0;t.addOrUpdateDeposit(n.teamGuid,i.userId,n.selectedMonth.value,n.year,i.defaultAmount).then(function(t){n.memberDeposits=t.records;u(t);common.ui.hideLoading();i.isLoading=!1})};n.removeDeposit=function(i){confirm("Bạn có chắc chắn rằng thành viên này chưa đóng quỹ?")&&(common.ui.showLoading(),i.isLoading=!0,t.removeDeposit(i.id,n.teamGuid,i.userId,n.selectedMonth.value,n.year,i.defaultAmount).then(function(t){n.memberDeposits=t.records;u(t);n.loadingOverlay=!1;common.ui.hideLoading();i.isLoading=!1}))};n.amountTextBoxEnter=function(t,i){t.which===13&&n.addOrUpdateDeposit(i)};n.loadExpenses=function(){n.activeTab="tfm-expenses";common.ui.showLoading();n.isLoading=!0;n.loadingOverlay=!0;t.loadFundExpenses(n.teamGuid,n.selectedMonth.value,n.year).then(function(t){n.expenses=t.records;u(t);common.ui.hideLoading();n.isLoading=!1;n.loadingOverlay=!1;e()})};n.addOrUpdateExpense=function(i){common.ui.showLoading();n.loadingOverlay=!0;var r=$("#newFundExpenseDateTime").val();i.datetime=moment($("#newFundExpenseDateTime").val(),"DD/MM/YYYY").toDate().toISOString();t.addOrUpdateFundExpense(n.teamGuid,i.id,n.selectedMonth.value,n.year,i.amount,i.notes,i.datetime).then(function(t){$("#newFundExpenseDateTime").val(r);n.expenses=t.records;u(t);common.ui.hideLoading();common.ui.notification.success("Cập nhật thông tin thành công");n.loadingOverlay=!1;(i.id==0||typeof i.id=="undefined")&&(n.newExpense.amount=null,n.newExpense.notes="")})};n.deleteExpense=function(i){confirm("Bạn chắc chắn muốn xóa?")&&(common.ui.showLoading(),n.loadingOverlay=!0,t.deleteFundExpense(n.teamGuid,n.selectedMonth.value,n.year,i.id).then(function(t){n.expenses=t.records;u(t);common.ui.hideLoading();n.loadingOverlay=!1}))};n.expenseInputsEnter=function(t,i){t.which===13&&n.addOrUpdateExpense(i)};n.loadMemberDeposits()}]);sportApp.controller("TeamFeedCtrl",["$scope","TeamService","$routeParams","CommonService","MatchFindingService",function(n,t,i,r,u){n.matchArchiveList=[];n.activeArchive={};n.totalArchive=0;n.loadMatchArchive=function(){u.searchMatchRecipientArchive().then(function(t){n.matchArchiveList=t.records;n.totalArchive=t.totalRecords})};n.showArchiveMatch=function(t){n.activeArchive=t;common.ui.modal.show("layout_modal_archiveMatch")};n.loadMatchArchive()}]).controller("TeamEventCtrl",["$scope","TeamService","$routeParams","CommonService","ImageUpload",function(n){n.activePage="event"}]).controller("TeamGalleryCtrl",["$scope","TeamService","$routeParams","CommonService","ImageUpload",function(n){n.activePage="gallery"}]);$(document).ready(function(){$(".tabs-chi-tiet-doi .list-link-doi li").click(function(){$(".tabs-chi-tiet-doi .list-link-doi li").removeClass("active");$(this).addClass("active")})})